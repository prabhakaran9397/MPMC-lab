.MODEL SMALL

.STACK 100H

.DATA
	FILENAME DB 'TESTFILE.TXT'
	STRING	 DB 'HELLO WORLD!$'
	STRLEN = $ - OFFSET STRING
	READVAL	 DB 20 DUP('$')
	HANDLE 	 DW ?
.CODE
BEGIN:
	MOV AX, @DATA		; INITIALISE
	MOV DS, AX
	
	LEA DX, FILENAME
	MOV CX, 0H
	MOV AX, 3D00H		; OPEN IN READ ONLY MODE
	INT 21H
	MOV HANDLE, AX

	LEA DX, READVAL		
	MOV CX, 0FFFFH
	MOV BX, HANDLE
	MOV AX, 3F00H		; READ FROM FILE
	INT 21H
	
	MOV BH, '$'
	MOV DI, 0000H
	LEA SI, READVAL

DO:	MOV BL, [SI]
	CMP BL, BH
	JE DONE
	INC SI
	INC DI
	JNE DO

DONE:
	MOV BX, HANDLE		; CLOSE FILE
	MOV AX, 3E00H		
	INT 21H

	LEA DX, FILENAME
	MOV CX, 0H
	MOV AX, 3D01H		; OPEN IN WRITE ONLY MODE
	INT 21H
	MOV HANDLE, AX

	MOV DX, DI		; SEEK VALUE
	MOV CX, 0H	
	MOV BX, HANDLE
	MOV AX, 4200H
	INT 21H

	LEA DX, STRING		
	MOV CX, STRLEN
	MOV BX, HANDLE
	MOV AX, 4000H		; WRITE IN FILE
	INT 21H

	MOV BX, HANDLE		; CLOSE FILE
	MOV AX, 3E00H		
	INT 21H

	MOV AH, 4CH		; RETURN
	INT 21H
END BEGIN
