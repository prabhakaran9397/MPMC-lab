.MODEL SMALL

.STACK 100H

.DATA
	FILENAME DB 'TESTFILE.TXT', 0H
	READVAL	 DB 80H DUP('$'), 0H
	STRLEN	 DB 1H
	NL	 DB 0DH, 0AH, '$', 0H
	HANDLE 	 DW ?, 0H
.CODE
BEGIN:	MOV AX, @DATA		; INITIALISE
	MOV DS, AX

	LEA DX, FILENAME
	MOV CX, 0H
	MOV AX, 3D00H		; OPEN IN READ ONLY MODE
	INT 21H
	MOV HANDLE, AX

	LEA DX, READVAL		
	MOV CX, 0FFFFH
	MOV BX, HANDLE
	MOV AX, 3F00H		; READ FROM FILE
	INT 21H

	LEA SI, READVAL		; REPLACING THE CONTENT (EG) E -> I
	MOV AL, '$'

EACH:	CMP [SI], AL
	JE DONE
	MOV BL, 'I'
	CMP [SI], BL
	JE REPL
BACK:	INC SI
	INC STRLEN
	JMP EACH

REPL:	MOV BH, 'E'
	MOV [SI], BH
	JMP BACK

DONE:	LEA DX, FILENAME	; DELETE FILE
	MOV AX, 4000H		
	INT 21H	

	LEA DX, FILENAME	; CREATE FILE
	MOV CX, 0H
	MOV AH, 3CH
	INT 21H
	MOV HANDLE, AX

	LEA DX, READVAL		
	MOV CL, STRLEN
	MOV CH, 0H
	MOV BX, HANDLE
	MOV AX, 4000H		; WRITE IN FILE
	INT 21H

	MOV BX, HANDLE		; CLOSE FILE
	MOV AX, 3E00H		
	INT 21H

	MOV AH, 4CH		; RETURN
	INT 21H

END BEGIN
